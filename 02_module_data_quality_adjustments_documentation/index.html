<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation for the Background chapter and four FASTR modules."><link href=https://FASTR-Analytics.github.io/docs/02_module_data_quality_adjustments_documentation/ rel=canonical><link href=../01_module_data_quality_assessment_documentation/ rel=prev><link href=../03_module_service_utilization_documentation/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.23"><title>Module 2 · Data Quality Adjustments - FASTR Methodology</title><link rel=stylesheet href=../assets/stylesheets/main.84d31ad4.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M64%20480c-35.3%200-64-28.7-64-64V96c0-35.3%2028.7-64%2064-64h320c35.3%200%2064%2028.7%2064%2064v213.5c0%2017-6.7%2033.3-18.7%2045.3L322.7%20461.3c-12%2012-28.3%2018.7-45.3%2018.7zm325.5-176H296c-13.3%200-24%2010.7-24%2024v93.5z%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M384%20512H96c-53%200-96-43-96-96V96C0%2043%2043%200%2096%200h304c26.5%200%2048%2021.5%2048%2048v288c0%2020.9-13.4%2038.7-32%2045.3V448c17.7%200%2032%2014.3%2032%2032s-14.3%2032-32%2032zM96%20384c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h256v-64zm32-232c0%2013.3%2010.7%2024%2024%2024h176c13.3%200%2024-10.7%2024-24s-10.7-24-24-24H152c-13.3%200-24%2010.7-24%2024m24%2072c-13.3%200-24%2010.7-24%2024s10.7%2024%2024%2024h176c13.3%200%2024-10.7%2024-24s-10.7-24-24-24z%22/%3E%3C/svg%3E');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%20512a256%20256%200%201%200%200-512%20256%20256%200%201%200%200%20512m-32-352a32%2032%200%201%201%2064%200%2032%2032%200%201%201-64%200m-8%2064h48c13.3%200%2024%2010.7%2024%2024v88h8c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-80c-13.3%200-24-10.7-24-24s10.7-24%2024-24h24v-64h-24c-13.3%200-24-10.7-24-24s10.7-24%2024-24%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M461.2%2018.9C472.7%2024%20480%2035.4%20480%2048v416c0%2012.6-7.3%2024-18.8%2029.1s-24.8%203.2-34.3-5.1l-46.6-40.7c-43.6-38.1-98.7-60.3-156.4-63V480c0%2017.7-14.3%2032-32%2032h-32c-17.7%200-32-14.3-32-32v-96C57.3%20384%200%20326.7%200%20256s57.3-128%20128-128h84.5c61.8-.2%20121.4-22.7%20167.9-63.3L427%2024c9.4-8.3%2022.9-10.2%2034.3-5.1zM224%20320v.2c70.3%202.7%20137.8%2028.5%20192%2073.4V118.3c-54.2%2044.9-121.7%2070.7-192%2073.4z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M434.8%2070.1c14.3%2010.4%2017.5%2030.4%207.1%2044.7l-256%20352c-5.5%207.6-14%2012.3-23.4%2013.1s-18.5-2.7-25.1-9.3l-128-128c-12.5-12.5-12.5-32.8%200-45.3s32.8-12.5%2045.3%200l101.5%20101.5%20234-321.7c10.4-14.3%2030.4-17.5%2044.7-7.1z%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%20512a256%20256%200%201%200%200-512%20256%20256%200%201%200%200%20512m0-336c-17.7%200-32%2014.3-32%2032%200%2013.3-10.7%2024-24%2024s-24-10.7-24-24c0-44.2%2035.8-80%2080-80s80%2035.8%2080%2080c0%2047.2-36%2067.2-56%2074.5v3.8c0%2013.3-10.7%2024-24%2024s-24-10.7-24-24v-8.1c0-20.5%2014.8-35.2%2030.1-40.2%206.4-2.1%2013.2-5.5%2018.2-10.3%204.3-4.2%207.7-10%207.7-19.6%200-17.7-14.3-32-32-32zm-32%20192a32%2032%200%201%201%2064%200%2032%2032%200%201%201-64%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%200c14.7%200%2028.2%208.1%2035.2%2021l216%20400c6.7%2012.4%206.4%2027.4-.8%2039.5S486.1%20480%20472%20480H40c-14.1%200-27.2-7.4-34.4-19.5s-7.5-27.1-.8-39.5l216-400c7-12.9%2020.5-21%2035.2-21m0%20352a32%2032%200%201%200%200%2064%2032%2032%200%201%200%200-64m0-192c-18.2%200-32.7%2015.5-31.4%2033.7l7.4%20104c.9%2012.5%2011.4%2022.3%2023.9%2022.3%2012.6%200%2023-9.7%2023.9-22.3l7.4-104c1.3-18.2-13.1-33.7-31.4-33.7z%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20576%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M480-16c6.9%200%2013%204.4%2015.2%2010.9l13.5%2040.4%2040.4%2013.5C555.6%2051%20560%2057.1%20560%2064s-4.4%2013-10.9%2015.2l-40.4%2013.5-13.5%2040.4c-2.2%206.5-8.3%2010.9-15.2%2010.9s-13-4.4-15.2-10.9l-13.5-40.4-40.4-13.5C404.4%2077%20400%2070.9%20400%2064s4.4-13%2010.9-15.2l40.4-13.5%2013.5-40.4C467-11.6%20473.1-16%20480-16M321.4%2097.4c12.5-12.5%2032.8-12.5%2045.3%200l80%2080c12.5%2012.5%2012.5%2032.8%200%2045.3l-10.9%2010.9c7.9%2022%2012.2%2045.7%2012.2%2070.5%200%20114.9-93.1%20208-208%20208S32%20418.9%2032%20304%20125.1%2096%20240%2096c24.7%200%2048.5%204.3%2070.5%2012.3zM144%20304c0-53%2043-96%2096-96%2013.3%200%2024-10.7%2024-24s-10.7-24-24-24c-79.5%200-144%2064.5-144%20144%200%2013.3%2010.7%2024%2024%2024s24-10.7%2024-24%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M416%20427.4c58.5-44%2096-111.6%2096-187.4C512%20107.5%20397.4%200%20256%200S0%20107.5%200%20240c0%2075.8%2037.5%20143.4%2096%20187.4V464c0%2026.5%2021.5%2048%2048%2048h32v-40c0-13.3%2010.7-24%2024-24s24%2010.7%2024%2024v40h64v-40c0-13.3%2010.7-24%2024-24s24%2010.7%2024%2024v40h32c26.5%200%2048-21.5%2048-48zM96%20256a64%2064%200%201%201%20128%200%2064%2064%200%201%201-128%200m256-64a64%2064%200%201%201%200%20128%2064%2064%200%201%201%200-128%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20640%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M352%200c0-17.7-14.3-32-32-32s-32%2014.3-32%2032v64h-96c-53%200-96%2043-96%2096v224c0%2053%2043%2096%2096%2096h256c53%200%2096-43%2096-96V160c0-53-43-96-96-96h-96zM160%20368c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24m120%200c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24m120%200c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24M224%20176a48%2048%200%201%201%200%2096%2048%2048%200%201%201%200-96m144%2048a48%2048%200%201%201%2096%200%2048%2048%200%201%201-96%200m-304%200c0-17.7-14.3-32-32-32S0%20206.3%200%20224v96c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32zm544-32c-17.7%200-32%2014.3-32%2032v96c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32v-96c0-17.7-14.3-32-32-32%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M288%200H128c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032v151.5L7.5%20426.3C2.6%20435%200%20444.7%200%20454.7%200%20486.4%2025.6%20512%2057.3%20512h333.4c31.6%200%2057.3-25.6%2057.3-57.3%200-10-2.6-19.8-7.5-28.4L320%20215.5V64c17.7%200%2032-14.3%2032-32S337.7%200%20320%200zm-96%20215.5V64h64v151.5c0%2011.1%202.9%2022.1%208.4%2031.8L306%20320H142l41.6-72.7c5.5-9.7%208.4-20.6%208.4-31.8%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M0%20216C0%20149.7%2053.7%2096%20120%2096h8c17.7%200%2032%2014.3%2032%2032s-14.3%2032-32%2032h-8c-30.9%200-56%2025.1-56%2056v8h64c35.3%200%2064%2028.7%2064%2064v64c0%2035.3-28.7%2064-64%2064H64c-35.3%200-64-28.7-64-64zm256%200c0-66.3%2053.7-120%20120-120h8c17.7%200%2032%2014.3%2032%2032s-14.3%2032-32%2032h-8c-30.9%200-56%2025.1-56%2056v8h64c35.3%200%2064%2028.7%2064%2064v64c0%2035.3-28.7%2064-64%2064h-64c-35.3%200-64-28.7-64-64z%22/%3E%3C/svg%3E');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../stylesheets/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=teal> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#module-2-data-quality-adjustment class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="FASTR Methodology" class="md-header__button md-logo" aria-label="FASTR Methodology" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> FASTR Methodology </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Module 2 · Data Quality Adjustments </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=teal aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=teal aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/FASTR-Analytics/docs title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> FASTR-Analytics/docs </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Overview </a> </li> <li class=md-tabs__item> <a href=../00_background_documentation/ class=md-tabs__link> Background </a> </li> <li class=md-tabs__item> <a href=../01_module_data_quality_assessment_documentation/ class=md-tabs__link> Module 1 · Data Quality Assessment </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> Module 2 · Data Quality Adjustments </a> </li> <li class=md-tabs__item> <a href=../03_module_service_utilization_documentation/ class=md-tabs__link> Module 3 · Service Utilization </a> </li> <li class=md-tabs__item> <a href=../04_module_coverage_estimates_documentation/ class=md-tabs__link> Module 4 · Coverage Estimates </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="FASTR Methodology" class="md-nav__button md-logo" aria-label="FASTR Methodology" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5zM6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5"/></svg> </a> FASTR Methodology </label> <div class=md-nav__source> <a href=https://github.com/FASTR-Analytics/docs title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> FASTR-Analytics/docs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../00_background_documentation/ class=md-nav__link> <span class=md-ellipsis> Background </span> </a> </li> <li class=md-nav__item> <a href=../01_module_data_quality_assessment_documentation/ class=md-nav__link> <span class=md-ellipsis> Module 1 · Data Quality Assessment </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Module 2 · Data Quality Adjustments </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Module 2 · Data Quality Adjustments </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-overview-what-why class=md-nav__link> <span class=md-ellipsis> 1. Overview (What &amp; Why) </span> </a> <nav class=md-nav aria-label="1. Overview (What & Why)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#what-does-this-module-do class=md-nav__link> <span class=md-ellipsis> What does this module do? </span> </a> </li> <li class=md-nav__item> <a href=#why-is-it-needed-in-the-fastr-pipeline class=md-nav__link> <span class=md-ellipsis> Why is it needed in the FASTR pipeline? </span> </a> </li> <li class=md-nav__item> <a href=#quick-summary class=md-nav__link> <span class=md-ellipsis> Quick Summary </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-how-it-works class=md-nav__link> <span class=md-ellipsis> 2. How It Works </span> </a> <nav class=md-nav aria-label="2. How It Works"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#high-level-workflow class=md-nav__link> <span class=md-ellipsis> High-Level Workflow </span> </a> </li> <li class=md-nav__item> <a href=#visual-workflow class=md-nav__link> <span class=md-ellipsis> Visual Workflow </span> </a> </li> <li class=md-nav__item> <a href=#key-decision-points class=md-nav__link> <span class=md-ellipsis> Key Decision Points </span> </a> </li> <li class=md-nav__item> <a href=#what-happens-to-the-data class=md-nav__link> <span class=md-ellipsis> What Happens to the Data </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-detailed-reference class=md-nav__link> <span class=md-ellipsis> 3. Detailed Reference </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../03_module_service_utilization_documentation/ class=md-nav__link> <span class=md-ellipsis> Module 3 · Service Utilization </span> </a> </li> <li class=md-nav__item> <a href=../04_module_coverage_estimates_documentation/ class=md-nav__link> <span class=md-ellipsis> Module 4 · Coverage Estimates </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=module-2-data-quality-adjustment>Module 2: Data Quality Adjustment<a class=headerlink href=#module-2-data-quality-adjustment title="Anchor link to this section">&para;</a></h1> <h2 id=1-overview-what-why>1. Overview (What &amp; Why)<a class=headerlink href=#1-overview-what-why title="Anchor link to this section">&para;</a></h2> <h3 id=what-does-this-module-do>What does this module do?<a class=headerlink href=#what-does-this-module-do title="Anchor link to this section">&para;</a></h3> <p>The Data Quality Adjustment module systematically corrects two common problems in routine health facility data: <strong>outliers</strong> (extreme values caused by reporting errors or data entry mistakes) and <strong>missing data</strong> (from incomplete reporting). Rather than simply deleting problematic data, this module replaces questionable values with statistically sound estimates based on each facility's own historical patterns.</p> <p>The module uses sophisticated temporal smoothing techniques that analyze trends over time. By calculating rolling averages and examining facility-specific historical patterns, it preserves the underlying trends in the data while correcting anomalous values. This approach ensures that adjusted data remains grounded in real service delivery patterns rather than arbitrary replacements.</p> <p>To accommodate different analytical needs, the module produces four parallel versions of the data: one with no adjustments (the original data), one with only outlier corrections, one with only missing data filled in, and one with both types of corrections applied. This multi-scenario approach allows analysts to understand how sensitive their results are to different data quality assumptions and choose the most appropriate version for their analysis.</p> <h3 id=why-is-it-needed-in-the-fastr-pipeline>Why is it needed in the FASTR pipeline?<a class=headerlink href=#why-is-it-needed-in-the-fastr-pipeline title="Anchor link to this section">&para;</a></h3> <p>Routine health management information system (HMIS) data often contains errors and gaps that can seriously distort trends, mask true patterns, and lead to incorrect conclusions. A single extreme outlier can make service volumes appear to spike dramatically, while missing data can make it seem like services stopped entirely. These issues are particularly problematic when:</p> <ul> <li>Tracking progress toward health goals and targets</li> <li>Comparing facilities or regions to identify high and low performers</li> <li>Allocating resources based on service delivery patterns</li> <li>Detecting genuine changes in health service utilization versus data quality issues</li> </ul> <p>By systematically addressing these data quality issues before analysis, this module ensures that downstream calculations and decisions are based on reliable, consistent data rather than artifacts of poor data quality.</p> <h3 id=quick-summary>Quick Summary<a class=headerlink href=#quick-summary title="Anchor link to this section">&para;</a></h3> <table> <thead> <tr> <th><strong>Aspect</strong></th> <th><strong>Details</strong></th> </tr> </thead> <tbody> <tr> <td><strong>Purpose</strong></td> <td>Replace outlier values and fill missing data using facility-specific historical patterns</td> </tr> <tr> <td><strong>Key Inputs</strong></td> <td>Raw HMIS data (<code>hmis_AFG.csv</code>)<br>Outlier flags from Module 1 (<code>M1_output_outliers.csv</code>)<br>Completeness flags from Module 1 (<code>M1_output_completeness.csv</code>)</td> </tr> <tr> <td><strong>Key Outputs</strong></td> <td>Facility-level adjusted data (<code>M2_adjusted_data.csv</code>)<br>Subnational aggregated data (<code>M2_adjusted_data_admin_area.csv</code>)<br>National aggregated data (<code>M2_adjusted_data_national.csv</code>)<br>Exclusion metadata (<code>M2_low_volume_exclusions.csv</code>)</td> </tr> <tr> <td><strong>Scenarios Produced</strong></td> <td>None (original data), Outliers only, Completeness only, Both adjustments</td> </tr> </tbody> </table> <hr> <h2 id=2-how-it-works>2. How It Works<a class=headerlink href=#2-how-it-works title="Anchor link to this section">&para;</a></h2> <h3 id=high-level-workflow>High-Level Workflow<a class=headerlink href=#high-level-workflow title="Anchor link to this section">&para;</a></h3> <p>The module follows a systematic seven-step process to clean and adjust health facility data:</p> <p><strong>Step 1: Load and Prepare Data</strong> The module brings together three datasets: the raw facility service volumes, the outlier flags identifying suspicious values (from Module 1), and the completeness flags showing which months had incomplete reporting (from Module 1). It also identifies certain sensitive indicators like deaths that should never be adjusted.</p> <p><strong>Step 2: Identify Low-Volume Indicators</strong> Before making any adjustments, the module checks each indicator to see if it has meaningful variation. Indicators that never have values above 100 across the entire dataset are flagged and excluded from outlier adjustment, since outlier detection isn't meaningful for consistently low-count indicators.</p> <p><strong>Step 3: Adjust Outlier Values</strong> For each value flagged as an outlier, the module calculates what the value "should have been" based on that facility's historical pattern. It uses a hierarchy of methods, preferring to use surrounding months when possible (like averaging the 3 months before and 3 months after), but falling back to other approaches if needed (like using the same month from the previous year for seasonal indicators).</p> <p><strong>Step 4: Fill Missing and Incomplete Data</strong> For months where data is missing or marked as incomplete, the module imputes (fills in) values using the same rolling average approach. This ensures that temporary reporting gaps don't create artificial drops to zero in the data.</p> <p><strong>Step 5: Create Multiple Scenarios</strong> The module runs the adjustment logic four different ways: with no adjustments (baseline), only outlier corrections, only completeness corrections, and both types of corrections together. This allows analysts to see how different choices affect their results.</p> <p><strong>Step 6: Aggregate to Geographic Levels</strong> After adjustments are complete, the facility-level data is aggregated (summed up) to create subnational and national-level datasets. Each geographic level maintains all four scenarios, so analysts can work at whichever level they need.</p> <p><strong>Step 7: Export Results</strong> The module saves four CSV files: one for facility-level data, one for subnational areas, one for national totals, and one documenting which indicators were excluded from adjustment and why.</p> <h3 id=visual-workflow>Visual Workflow<a class=headerlink href=#visual-workflow title="Anchor link to this section">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>┌─────────────────────────────────────────────────────────────┐
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>│ INPUTS                                                      │
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>│                                                             │
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>│  Raw HMIS Data          Outlier Flags      Completeness    │
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>│  (service volumes)      (from Module 1)    Flags           │
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>│                                            (from Module 1)  │
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>└──────────────┬──────────────────────────────────────────────┘
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>               │
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>               ▼
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>┌─────────────────────────────────────────────────────────────┐
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>│ STEP 1: Data Preparation                                    │
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>│  • Merge datasets by facility, indicator, and month         │
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>│  • Identify excluded indicators (deaths)                    │
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>│  • Check for low-volume indicators                          │
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>└──────────────┬──────────────────────────────────────────────┘
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>               │
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>               ▼
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>┌─────────────────────────────────────────────────────────────┐
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>│ STEP 2: Calculate Rolling Averages                          │
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>│  • Centered 6-month average (3 before + 3 after)            │
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>│  • Forward 6-month average (next 6 months)                  │
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>│  • Backward 6-month average (previous 6 months)             │
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>│  • Facility-specific historical mean                        │
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a>└──────────────┬──────────────────────────────────────────────┘
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>               │
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a>               ▼
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a>┌─────────────────────────────────────────────────────────────┐
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a>│ STEP 3: Apply Adjustment Hierarchy                          │
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a>│                                                             │
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a>│  For Outliers:                 For Missing/Incomplete:      │
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a>│  1. Use centered average       1. Use centered average      │
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a>│  2. Use forward average        2. Use forward average       │
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a>│  3. Use backward average       3. Use backward average      │
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a>│  4. Use same month last year   4. Use historical mean       │
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a>│  5. Use historical mean                                     │
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a>└──────────────┬──────────────────────────────────────────────┘
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a>               │
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a>               ▼
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39 href=#__codelineno-0-39></a>┌─────────────────────────────────────────────────────────────┐
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40 href=#__codelineno-0-40></a>│ STEP 4: Create Four Scenarios                               │
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41 href=#__codelineno-0-41></a>│                                                             │
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42 href=#__codelineno-0-42></a>│  ┌─────────────┐  ┌──────────────┐  ┌─────────────────┐   │
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43 href=#__codelineno-0-43></a>│  │   None      │  │   Outliers   │  │  Completeness   │   │
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44 href=#__codelineno-0-44></a>│  │ (original)  │  │   Only       │  │     Only        │   │
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45 href=#__codelineno-0-45></a>│  └─────────────┘  └──────────────┘  └─────────────────┘   │
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46 href=#__codelineno-0-46></a>│                                                             │
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47 href=#__codelineno-0-47></a>│                   ┌──────────────┐                          │
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48 href=#__codelineno-0-48></a>│                   │     Both     │                          │
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49 href=#__codelineno-0-49></a>│                   │  Adjustments │                          │
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50 href=#__codelineno-0-50></a>│                   └──────────────┘                          │
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51 href=#__codelineno-0-51></a>└──────────────┬──────────────────────────────────────────────┘
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52 href=#__codelineno-0-52></a>               │
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53 href=#__codelineno-0-53></a>               ▼
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54 href=#__codelineno-0-54></a>┌─────────────────────────────────────────────────────────────┐
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55 href=#__codelineno-0-55></a>│ STEP 5: Geographic Aggregation                              │
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56 href=#__codelineno-0-56></a>│                                                             │
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57 href=#__codelineno-0-57></a>│  Facility Level → Subnational Level → National Level        │
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58 href=#__codelineno-0-58></a>│  (individual)     (provinces/         (country total)       │
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59 href=#__codelineno-0-59></a>│                    districts)                               │
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60 href=#__codelineno-0-60></a>│                                                             │
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61 href=#__codelineno-0-61></a>│  Each level maintains all 4 scenarios                       │
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62 href=#__codelineno-0-62></a>└──────────────┬──────────────────────────────────────────────┘
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63 href=#__codelineno-0-63></a>               │
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64 href=#__codelineno-0-64></a>               ▼
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65 href=#__codelineno-0-65></a>┌─────────────────────────────────────────────────────────────┐
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66 href=#__codelineno-0-66></a>│ OUTPUTS                                                     │
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67 href=#__codelineno-0-67></a>│                                                             │
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68 href=#__codelineno-0-68></a>│  M2_adjusted_data.csv           (facility level)            │
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69 href=#__codelineno-0-69></a>│  M2_adjusted_data_admin_area.csv (subnational)             │
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70 href=#__codelineno-0-70></a>│  M2_adjusted_data_national.csv  (national)                 │
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71 href=#__codelineno-0-71></a>│  M2_low_volume_exclusions.csv   (metadata)                 │
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72 href=#__codelineno-0-72></a>└─────────────────────────────────────────────────────────────┘
</span></code></pre></div> <h3 id=key-decision-points>Key Decision Points<a class=headerlink href=#key-decision-points title="Anchor link to this section">&para;</a></h3> <p><strong>Which values should be adjusted?</strong> The module adjusts two types of problematic values: - Values flagged as outliers by Module 1's statistical detection algorithms - Values from months marked as incomplete or entirely missing</p> <p>However, certain indicators are NEVER adjusted: - Death counts (under-5 deaths, maternal deaths, neonatal deaths) because these represent discrete events that should not be smoothed - Low-volume indicators (those that never exceed 100) where outlier detection isn't meaningful</p> <p><strong>How are replacement values calculated?</strong> The module follows a hierarchy from most to least reliable:</p> <ol> <li><strong>Best option</strong>: Use the average of surrounding months (3 before and 3 after) if available</li> <li><strong>Good option</strong>: If surrounding months aren't available, use either future months or past months</li> <li><strong>Acceptable option</strong>: For seasonal indicators, use the same month from last year (e.g., June 2022 to replace June 2023)</li> <li><strong>Fallback option</strong>: Use the facility's overall average for that indicator if nothing else works</li> </ol> <p>This hierarchy ensures that replacements are as contextually relevant as possible, using the most recent and similar data available.</p> <p><strong>Which scenario should analysts use?</strong> By producing four scenarios, the module allows different use cases:</p> <ul> <li><strong>None</strong>: Use for validation or when data quality is already excellent</li> <li><strong>Outliers only</strong>: Use when completeness is good but occasional extreme values are problematic</li> <li><strong>Completeness only</strong>: Use when you trust the reported values but reporting is sporadic</li> <li><strong>Both</strong>: Use when both data quality issues are prevalent (most common choice)</li> </ul> <h3 id=what-happens-to-the-data>What Happens to the Data<a class=headerlink href=#what-happens-to-the-data title="Anchor link to this section">&para;</a></h3> <p><strong>Before adjustment</strong>, a facility's monthly service volume data might look like this:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>Month      Deliveries   Issue
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>Jan 2023   78           OK
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>Feb 2023   450          OUTLIER (data entry error)
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>Mar 2023   [missing]    INCOMPLETE REPORTING
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>Apr 2023   82           OK
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>May 2023   85           OK
</span></code></pre></div> <p><strong>After adjustment</strong> (using the "both" scenario), the same data becomes:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>Month      Original   Adjusted   Method Used
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>Jan 2023   78         78         No adjustment needed
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>Feb 2023   450        82         Replaced using 6-month average
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>Mar 2023   [missing]  80         Filled using 6-month average
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>Apr 2023   82         82         No adjustment needed
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>May 2023   85         85         No adjustment needed
</span></code></pre></div> <p>The adjusted data maintains realistic values that fit the facility's typical pattern, making it suitable for trend analysis, comparison with other facilities, and resource planning.</p> <hr> <h2 id=3-detailed-reference>3. Detailed Reference<a class=headerlink href=#3-detailed-reference title="Anchor link to this section">&para;</a></h2> <details> <summary><strong>Configuration Parameters</strong></summary> ### Excluded Indicators Some indicators are excluded from all adjustments due to their sensitive nature: <div class="language-r highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>EXCLUDED_FROM_ADJUSTMENT</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>c</span><span class=p>(</span><span class=s>&quot;u5_deaths&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;maternal_deaths&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;neonatal_deaths&quot;</span><span class=p>)</span>
</span></code></pre></div> **Rationale**: Death counts should not be smoothed or imputed as they represent discrete events that may have genuine temporal variation. Adjusting these could mask important epidemiological patterns or outbreak signals. ### Low Volume Exclusions Indicators are also automatically excluded from **outlier adjustment** if they have zero observations above 100 across the entire dataset. This prevents meaningless outlier detection on indicators with consistently low counts. **Exclusion Logic**: <div class="language-r highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=n>volume_check</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=n>raw_data</span><span class=p>[,</span><span class=w> </span><span class=nf>.</span><span class=p>(</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=w>  </span><span class=n>above_100</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>sum</span><span class=p>(</span><span class=n>count</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=m>100</span><span class=p>,</span><span class=w> </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>),</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>  </span><span class=n>total</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>.N</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=p>),</span><span class=w> </span><span class=n>by</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>indicator_common_id</span><span class=p>]</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=n>no_outlier_adj</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=n>volume_check</span><span class=p>[</span><span class=n>above_100</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=m>0</span><span class=p>,</span><span class=w> </span><span class=n>indicator_common_id</span><span class=p>]</span>
</span></code></pre></div> This information is saved to `M2_low_volume_exclusions.csv` for transparency. ### Rolling Window Configuration The module uses a **6-month window** for all rolling averages. This choice balances: **Advantages**: - Captures medium-term trends - Reduces impact of short-term fluctuations - Sufficient data points for stable averages - Works well for both stable and seasonal indicators **Trade-offs**: - May not capture rapid changes in service delivery - Could over-smooth in cases of genuine programmatic shifts - Requires at least 6 valid observations for optimal centered average </details> <details> <summary><strong>Input/Output Specifications</strong></summary> ### Input Files The module requires three input files from previous processing steps: | File | Source | Description | Key Variables | |------|--------|-------------|---------------| | `hmis_AFG.csv` | Raw HMIS data | Facility-level service volumes | `facility_id`, `indicator_common_id`, `period_id`, `count`, admin area columns | | `M1_output_outliers.csv` | Module 1 | Outlier flags for each facility-month-indicator | `facility_id`, `indicator_common_id`, `period_id`, `outlier_flag` | | `M1_output_completeness.csv` | Module 1 | Completeness flags for each facility-month-indicator | `facility_id`, `indicator_common_id`, `period_id`, `completeness_flag` | ### Input Data Structure **Raw HMIS Data (`hmis_AFG.csv`)**: <div class="language-text highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>facility_id | admin_area_1 | admin_area_2 | admin_area_3 | period_id | indicator_common_id | count
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>------------|--------------|--------------|--------------|-----------|---------------------|-------
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>FAC001      | AFG          | Kabul        | District_A   | 202301    | anc1                | 145
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>FAC001      | AFG          | Kabul        | District_A   | 202302    | anc1                | 152
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>FAC001      | AFG          | Kabul        | District_A   | 202303    | anc1                | 890  # Outlier
</span></code></pre></div> **Outlier Flags (`M1_output_outliers.csv`)**: <div class="language-text highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>facility_id | indicator_common_id | period_id | outlier_flag
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>------------|---------------------|-----------|-------------
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>FAC001      | anc1                | 202301    | 0
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>FAC001      | anc1                | 202302    | 0
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>FAC001      | anc1                | 202303    | 1           # Flagged as outlier
</span></code></pre></div> **Completeness Flags (`M1_output_completeness.csv`)**: <div class="language-text highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>facility_id | indicator_common_id | period_id | completeness_flag
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>------------|---------------------|-----------|------------------
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>FAC001      | anc1                | 202301    | 1             # Complete
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>FAC001      | anc1                | 202302    | 0             # Incomplete
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>FAC001      | anc1                | 202303    | 1             # Complete
</span></code></pre></div> ### Output Files The module generates four output files: | File | Level | Description | Key Columns | |------|-------|-------------|-------------| | `M2_adjusted_data.csv` | Facility | Adjusted volumes for all scenarios at facility level | `facility_id`, admin areas (excl. admin_area_1), `period_id`, `indicator_common_id`, `count_final_*` | | `M2_adjusted_data_admin_area.csv` | Subnational | Aggregated adjusted volumes at subnational admin areas | Admin areas (excl. admin_area_1), `period_id`, `indicator_common_id`, `count_final_*` | | `M2_adjusted_data_national.csv` | National | Aggregated adjusted volumes at national level | `admin_area_1`, `period_id`, `indicator_common_id`, `count_final_*` | | `M2_low_volume_exclusions.csv` | Metadata | Indicators excluded from outlier adjustment due to low volumes | `indicator_common_id`, `low_volume_exclude` | ### Output Data Structure **Facility-Level Output** (`M2_adjusted_data.csv`): <div class="language-text highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>facility_id | admin_area_2 | admin_area_3 | period_id | indicator_common_id | count_final_none | count_final_outliers | count_final_completeness | count_final_both
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>------------|--------------|--------------|-----------|---------------------|------------------|----------------------|--------------------------|------------------
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>FAC001      | Kabul        | District_A   | 202301    | anc1                | 145              | 145                  | 145                      | 145
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>FAC001      | Kabul        | District_A   | 202302    | anc1                | 152              | 152                  | 148                      | 148
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>FAC001      | Kabul        | District_A   | 202303    | anc1                | 890              | 148                  | 890                      | 148
</span></code></pre></div> Each `count_final_*` column represents a different adjustment scenario: - `count_final_none`: No adjustments applied (original values) - `count_final_outliers`: Only outlier adjustment applied - `count_final_completeness`: Only completeness adjustment applied - `count_final_both`: Both outlier and completeness adjustments applied </details> <details> <summary><strong>Key Functions Documentation</strong></summary> ### Required Libraries The module depends on the following R packages: - `data.table` - High-performance data manipulation and aggregation - `zoo` - Rolling window calculations (`frollmean` for rolling averages) - `lubridate` - Date handling and manipulation ### 1. `apply_adjustments()` Core function that implements the adjustment logic for a single scenario. **Purpose**: Replaces outlier and/or incomplete values using rolling averages and historical patterns. **Parameters**: - `raw_data` (data.table): Original HMIS data with service counts - `completeness_data` (data.table): Completeness flags from Module 1 - `outlier_data` (data.table): Outlier flags from Module 1 - `adjust_outliers` (logical): Whether to apply outlier adjustment - `adjust_completeness` (logical): Whether to apply completeness adjustment **Returns**: data.table with adjusted values in `count_working` column and adjustment metadata **Key Operations**: 1. Merges input datasets by `facility_id`, `indicator_common_id`, and `period_id` 2. Converts `period_id` to dates for temporal ordering 3. Calculates rolling averages (centered, forward, backward) for valid values 4. Applies adjustment hierarchy based on data availability 5. Tracks adjustment method used for each replaced value ### 2. `apply_adjustments_scenarios()` Wrapper function that runs adjustments across all four scenarios. **Purpose**: Applies the adjustment logic under different combinations of outlier and completeness adjustments. **Parameters**: - `raw_data` (data.table): Original HMIS data - `completeness_data` (data.table): Completeness flags - `outlier_data` (data.table): Outlier flags **Returns**: data.table with four `count_final_*` columns, one per scenario **Scenarios Processed**: 1. `none`: No adjustments (baseline) 2. `outliers`: Outlier adjustment only 3. `completeness`: Completeness adjustment only 4. `both`: Sequential outlier then completeness adjustment **Processing Logic**: - Calls `apply_adjustments()` once per scenario - Preserves original values for excluded indicators (deaths) - Merges all scenario results into a single wide-format table </details> <details> <summary><strong>Statistical Methods & Algorithms</strong></summary> ### Outlier Adjustment Methodology Outlier adjustment is applied to any facility-month value flagged in Module 1 (`outlier_flag == 1`). The goal is to replace these outlier values using valid historical data from the same facility and indicator. **Statistical Approach**: Rolling averages are used to estimate expected values. A rolling average (also called moving average) is the mean of a set of time periods surrounding the target period. This technique smooths short-term fluctuations and highlights longer-term trends. **Valid Values Definition**: Only values meeting ALL of the following criteria are used in calculations: - `count > 0` (positive non-zero values) - `!is.na(count)` (non-missing) - `outlier_flag == 0` (not flagged as outlier) **Implementation**: The module uses `frollmean()` from the `zoo` package for efficient rolling calculations: <div class="language-r highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=n>data_adj</span><span class=p>[,</span><span class=w> </span><span class=n>valid_count</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nf>fifelse</span><span class=p>(</span><span class=n>outlier_flag</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=m>0L</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=o>!</span><span class=nf>is.na</span><span class=p>(</span><span class=n>count</span><span class=p>),</span><span class=w> </span><span class=n>count</span><span class=p>,</span><span class=w> </span><span class=kc>NA_real_</span><span class=p>)]</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=n>data_adj</span><span class=p>[,</span><span class=w> </span><span class=nf>`:=`</span><span class=p>(</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>  </span><span class=n>roll6</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=nf>frollmean</span><span class=p>(</span><span class=n>valid_count</span><span class=p>,</span><span class=w> </span><span class=m>6</span><span class=p>,</span><span class=w> </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>,</span><span class=w> </span><span class=n>align</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;center&quot;</span><span class=p>),</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>  </span><span class=n>fwd6</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=nf>frollmean</span><span class=p>(</span><span class=n>valid_count</span><span class=p>,</span><span class=w> </span><span class=m>6</span><span class=p>,</span><span class=w> </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>,</span><span class=w> </span><span class=n>align</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;left&quot;</span><span class=p>),</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>  </span><span class=n>bwd6</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=nf>frollmean</span><span class=p>(</span><span class=n>valid_count</span><span class=p>,</span><span class=w> </span><span class=m>6</span><span class=p>,</span><span class=w> </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>,</span><span class=w> </span><span class=n>align</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;right&quot;</span><span class=p>),</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>  </span><span class=n>fallback</span><span class=o>=</span><span class=w> </span><span class=nf>mean</span><span class=p>(</span><span class=n>valid_count</span><span class=p>,</span><span class=w> </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>)</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=p>),</span><span class=w> </span><span class=n>by</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>.</span><span class=p>(</span><span class=n>facility_id</span><span class=p>,</span><span class=w> </span><span class=n>indicator_common_id</span><span class=p>)]</span>
</span></code></pre></div> ### Adjustment Hierarchy for Outliers The adjustment process follows this **hierarchical order** (stopping at the first available method): 1. **Centered 6-Month Average (`roll6`)** - Uses the three months before and three months after the outlier month - Provides a balanced average based on nearby trends - Applied when enough valid values exist on both sides of the month - Method tag: `roll6` 2. **Forward-Looking 6-Month Average (`fwd6`)** - Used if the centered average can't be calculated (e.g. early in the time series) - Takes the average of the next six valid months - Method tag: `forward` 3. **Backward-Looking 6-Month Average (`bwd6`)** - Used if neither `roll6` nor `fwd6` are available - Takes the average of the six most recent valid months before the outlier - Method tag: `backward` 4. **Same Month from Previous Year** - If no valid 6-month average exists, the value from the **same calendar month in the previous year** is used (e.g., Jan 2023 for Jan 2024) - Only applied if that previous value is valid (not an outlier, and > 0) - Particularly useful for seasonal indicators (e.g., malaria, respiratory infections) - Method tag: `same_month_last_year` - **Implementation**: <div class="language-r highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=n>data_adj</span><span class=p>[,</span><span class=w> </span><span class=nf>`:=`</span><span class=p>(</span><span class=n>mm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>month</span><span class=p>(</span><span class=n>date</span><span class=p>),</span><span class=w> </span><span class=n>yy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>year</span><span class=p>(</span><span class=n>date</span><span class=p>))]</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=n>data_adj</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=n>data_adj</span><span class=p>[,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=w>  </span><span class=kr>for</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=kr>in</span><span class=w> </span><span class=nf>which</span><span class=p>(</span><span class=n>outlier_flag</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=m>1L</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=nf>is.na</span><span class=p>(</span><span class=n>adj_method</span><span class=p>)))</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>    </span><span class=n>j</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>which</span><span class=p>(</span><span class=n>mm</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>mm</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>yy</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>yy</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>outlier_flag</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=m>0L</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=o>!</span><span class=nf>is.na</span><span class=p>(</span><span class=n>count</span><span class=p>))</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>    </span><span class=kr>if</span><span class=w> </span><span class=p>(</span><span class=nf>length</span><span class=p>(</span><span class=n>j</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=m>1L</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>      </span><span class=n>count_working</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=n>count</span><span class=p>[</span><span class=n>j</span><span class=p>]</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=w>      </span><span class=n>adj_method</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w>    </span><span class=o>&lt;-</span><span class=w> </span><span class=s>&quot;same_month_last_year&quot;</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=w>      </span><span class=n>adjust_note</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w>   </span><span class=o>&lt;-</span><span class=w> </span><span class=nf>format</span><span class=p>(</span><span class=n>date</span><span class=p>[</span><span class=n>j</span><span class=p>],</span><span class=w> </span><span class=s>&quot;%b-%Y&quot;</span><span class=p>)</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>  </span><span class=n>.SD</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=p>},</span><span class=w> </span><span class=n>by</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>.</span><span class=p>(</span><span class=n>facility_id</span><span class=p>,</span><span class=w> </span><span class=n>indicator_common_id</span><span class=p>)]</span>
</span></code></pre></div> 5. **Mean of All Historical Values (Fallback)** - If all previous methods fail, the mean of all valid historical values for that facility-indicator is used - Provides a facility-specific baseline when no temporal pattern is available - Method tag: `fallback` **Edge Case**: If no valid replacement can be found from any of these methods, the original outlier value is retained. ### Completeness Adjustment Methodology Completeness adjustment is applied to any facility-month where: - The month is flagged as incomplete (`completeness_flag != 1`) in Module 1, OR - The value is missing (`is.na(count_working)`) **Statistical Approach**: The same rolling average methodology is applied, but the definition of "valid values" differs slightly: **Valid Values for Completeness Adjustment**: - `!is.na(count_working)` (non-missing, possibly already adjusted for outliers) - `outlier_flag == 0` (not flagged as outlier in original data) **Key Difference from Outlier Adjustment**: - Completeness adjustment can use values that were already adjusted for outliers (when scenarios include both adjustments) - No same-month-last-year method is used (only rolling averages and fallback) **Implementation**: <div class="language-r highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=n>data_adj</span><span class=p>[,</span><span class=w> </span><span class=n>valid_count</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nf>fifelse</span><span class=p>(</span><span class=o>!</span><span class=nf>is.na</span><span class=p>(</span><span class=n>count_working</span><span class=p>)</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>outlier_flag</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=m>0L</span><span class=p>,</span><span class=w> </span><span class=n>count_working</span><span class=p>,</span><span class=w> </span><span class=kc>NA_real_</span><span class=p>)]</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=n>data_adj</span><span class=p>[,</span><span class=w> </span><span class=nf>`:=`</span><span class=p>(</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=w>  </span><span class=n>roll6</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=nf>frollmean</span><span class=p>(</span><span class=n>valid_count</span><span class=p>,</span><span class=w> </span><span class=m>6</span><span class=p>,</span><span class=w> </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>,</span><span class=w> </span><span class=n>align</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;center&quot;</span><span class=p>),</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>  </span><span class=n>fwd6</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=nf>frollmean</span><span class=p>(</span><span class=n>valid_count</span><span class=p>,</span><span class=w> </span><span class=m>6</span><span class=p>,</span><span class=w> </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>,</span><span class=w> </span><span class=n>align</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;left&quot;</span><span class=p>),</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=w>  </span><span class=n>bwd6</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=nf>frollmean</span><span class=p>(</span><span class=n>valid_count</span><span class=p>,</span><span class=w> </span><span class=m>6</span><span class=p>,</span><span class=w> </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>,</span><span class=w> </span><span class=n>align</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;right&quot;</span><span class=p>),</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=w>  </span><span class=n>fallback</span><span class=o>=</span><span class=w> </span><span class=nf>mean</span><span class=p>(</span><span class=n>valid_count</span><span class=p>,</span><span class=w> </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>)</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=p>),</span><span class=w> </span><span class=n>by</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>.</span><span class=p>(</span><span class=n>facility_id</span><span class=p>,</span><span class=w> </span><span class=n>indicator_common_id</span><span class=p>)]</span>
</span></code></pre></div> ### Adjustment Hierarchy for Completeness The replacement follows this **hierarchical order**: 1. **Centered 6-Month Average (`roll6`)** - Uses three valid months before and after the missing or incomplete month - Preferred method when sufficient surrounding data exists - Method tag: `roll6` 2. **Forward-Looking 6-Month Average (`fwd6`)** - Used if the centered average cannot be calculated (e.g., at start of time series) - Method tag: `forward` 3. **Backward-Looking 6-Month Average (`bwd6`)** - Used if no centered or forward-looking values are available (e.g., at end of time series) - Method tag: `backward` 4. **Mean of All Historical Values (Fallback)** - If no rolling averages can be calculated, uses the mean of all valid values for that facility-indicator - Provides a facility-specific baseline - Method tag: `fallback` **Edge Case**: If no valid replacement is found, the value remains missing (`NA`). ### Scenario Processing Logic The module processes all four adjustment scenarios simultaneously using the `apply_adjustments_scenarios()` function: **Scenario 1: None** (`count_final_none`) - `adjust_outliers = FALSE`, `adjust_completeness = FALSE` - Original raw data with no modifications - Serves as baseline for comparison **Scenario 2: Outliers** (`count_final_outliers`) - `adjust_outliers = TRUE`, `adjust_completeness = FALSE` - Only outlier values are replaced - Missing/incomplete values remain as-is - Use case: When completeness is high but outliers are a concern **Scenario 3: Completeness** (`count_final_completeness`) - `adjust_outliers = FALSE`, `adjust_completeness = TRUE` - Only missing/incomplete values are imputed - Outliers are retained in the data - Use case: When data quality is good but reporting is sporadic **Scenario 4: Both** (`count_final_both`) - `adjust_outliers = TRUE`, `adjust_completeness = TRUE` - **Sequential processing**: Outliers adjusted first, then completeness - Most comprehensive adjustment - Use case: When both data quality issues are prevalent **Processing Order for "Both" Scenario**: 1. Outlier adjustment creates `count_working` with outliers replaced 2. Completeness adjustment then operates on `count_working`, using the already-adjusted values 3. This ensures completeness imputation uses cleaned (non-outlier) values when available **Important**: After scenario-specific adjustments, excluded indicators (deaths) are reset to their original values: <div class="language-r highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=n>dat</span><span class=p>[</span><span class=n>indicator_common_id</span><span class=w> </span><span class=o>%in%</span><span class=w> </span><span class=n>EXCLUDED_FROM_ADJUSTMENT</span><span class=p>,</span><span class=w> </span><span class=n>count_working</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=n>count</span><span class=p>]</span>
</span></code></pre></div> ### Aggregation Methods All geographic aggregations use **simple sums**: <div class="language-r highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=nf>sum</span><span class=p>(</span><span class=n>count_final_both</span><span class=p>,</span><span class=w> </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>)</span>
</span></code></pre></div> **Rationale**: - Service volumes are additive (e.g., total deliveries = sum of facility deliveries) - Missing values (`NA`) are treated as zero in aggregation - Consistent with standard HMIS reporting practices **Caution**: If many facilities have `NA` values after adjustment, subnational/national totals may be underestimated. The `count_final_none` scenario provides a reference point for assessing impact. ### Handling Missing Data in Calculations The module applies `na.rm = TRUE` in all rolling calculations: <div class="language-r highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=nf>frollmean</span><span class=p>(</span><span class=n>valid_count</span><span class=p>,</span><span class=w> </span><span class=m>6</span><span class=p>,</span><span class=w> </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>,</span><span class=w> </span><span class=n>align</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;center&quot;</span><span class=p>)</span>
</span></code></pre></div> **Implication**: Rolling averages are calculated from available valid values only. If fewer than 6 values exist, the average is computed from whatever is available. If no valid values exist, the result is `NA`. </details> <details> <summary><strong>Code Examples</strong></summary> ### Example 1: Outlier Adjustment **Scenario**: A facility reports an unusually high ANC1 visit count in March 2023. **Data**: <div class="language-text highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>period_id | count | outlier_flag | Surrounding valid values
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>----------|-------|--------------|-------------------------
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>202301    | 145   | 0            | valid
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>202302    | 152   | 0            | valid
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>202303    | 890   | 1            | OUTLIER
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>202304    | 148   | 0            | valid
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a>202305    | 155   | 0            | valid
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a>202306    | 147   | 0            | valid
</span></code></pre></div> **Adjustment Calculation** (centered 6-month average): - Valid values: [145, 152, 148, 155, 147] (excludes outlier 890) - Average: (145 + 152 + 148 + 155 + 147) / 5 = 149.4 - **Adjusted value**: 149.4 **Method used**: `roll6` ### Example 2: Completeness Adjustment **Scenario**: A facility fails to report malaria tests in February 2023. **Data**: <div class="language-text highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>period_id | count | completeness_flag | Surrounding valid values
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>----------|-------|-------------------|-------------------------
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>202301    | 45    | 1                 | valid
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>202302    | NA    | 0                 | INCOMPLETE
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>202303    | 48    | 1                 | valid
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>202304    | 52    | 1                 | valid
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a>202305    | 50    | 1                 | valid
</span></code></pre></div> **Adjustment Calculation** (centered 6-month average): - Valid values: [45, 48, 52, 50, ...] - Average: 48.75 (using available surrounding months) - **Imputed value**: 48.75 **Method used**: `roll6` ### Example 3: Seasonal Indicator with Same-Month-Last-Year **Scenario**: Malaria cases show strong seasonality, and a June 2023 outlier needs adjustment. **Data**: <div class="language-text highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>period_id | count | outlier_flag | Notes
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>----------|-------|--------------|-------
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>202206    | 234   | 0            | June 2022 (valid)
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>202306    | 1850  | 1            | June 2023 (OUTLIER)
</span></code></pre></div> **Adjustment Logic**: 1. Centered, forward, and backward rolling averages unavailable (insufficient data) 2. Same-month-last-year method activated 3. June 2022 value = 234 (valid) 4. **Adjusted value**: 234 **Method used**: `same_month_last_year` ### Example 4: Scenario Comparison **Facility**: FAC001 **Indicator**: Institutional deliveries **Period**: Q1 2023 **Original Data**: <div class="language-text highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>Month    | Count | Outlier? | Complete?
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>---------|-------|----------|----------
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>Jan 2023 | 78    | No       | Yes
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a>Feb 2023 | 450   | Yes      | Yes       # Outlier
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>Mar 2023 | NA    | -        | No        # Incomplete
</span></code></pre></div> **Scenario Results**: | Month | None | Outliers | Completeness | Both | |----------|------|----------|--------------|------| | Jan 2023 | 78 | 78 | 78 | 78 | | Feb 2023 | 450 | 82* | 450 | 82* | | Mar 2023 | NA | NA | 80** | 80** | *Adjusted using rolling average **Imputed using rolling average **Interpretation**: - **None**: Raw data with obvious issues - **Outliers**: February corrected, but March remains missing - **Completeness**: March filled in, but February outlier retained - **Both**: Most complete and clean dataset ### Example 5: Geographic Aggregation **Subnational Aggregation Code**: <div class="language-r highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=n>adjusted_data_admin_area_final</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=n>adjusted_data_export</span><span class=p>[</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=w>  </span><span class=p>,</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=w>  </span><span class=nf>.</span><span class=p>(</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=w>    </span><span class=n>count_final_none</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=nf>sum</span><span class=p>(</span><span class=n>count_final_none</span><span class=p>,</span><span class=w>         </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>),</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=w>    </span><span class=n>count_final_outliers</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=nf>sum</span><span class=p>(</span><span class=n>count_final_outliers</span><span class=p>,</span><span class=w>     </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>),</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=w>    </span><span class=n>count_final_completeness</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>sum</span><span class=p>(</span><span class=n>count_final_completeness</span><span class=p>,</span><span class=w> </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>),</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=w>    </span><span class=n>count_final_both</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=nf>sum</span><span class=p>(</span><span class=n>count_final_both</span><span class=p>,</span><span class=w>         </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>)</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=w>  </span><span class=p>),</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=w>  </span><span class=n>by</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>c</span><span class=p>(</span><span class=n>geo_admin_area_sub</span><span class=p>,</span><span class=w> </span><span class=s>&quot;indicator_common_id&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;period_id&quot;</span><span class=p>)</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=p>]</span>
</span></code></pre></div> **National Aggregation Code**: <div class="language-r highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=n>adjusted_data_national_final</span><span class=w> </span><span class=o>&lt;-</span><span class=w> </span><span class=n>adjusted_data_export</span><span class=p>[</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=w>  </span><span class=p>,</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=w>  </span><span class=nf>.</span><span class=p>(</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=w>    </span><span class=n>count_final_none</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=nf>sum</span><span class=p>(</span><span class=n>count_final_none</span><span class=p>,</span><span class=w>         </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>),</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=w>    </span><span class=n>count_final_outliers</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=nf>sum</span><span class=p>(</span><span class=n>count_final_outliers</span><span class=p>,</span><span class=w>     </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>),</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=w>    </span><span class=n>count_final_completeness</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>sum</span><span class=p>(</span><span class=n>count_final_completeness</span><span class=p>,</span><span class=w> </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>),</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=w>    </span><span class=n>count_final_both</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=nf>sum</span><span class=p>(</span><span class=n>count_final_both</span><span class=p>,</span><span class=w>         </span><span class=n>na.rm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>TRUE</span><span class=p>)</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=w>  </span><span class=p>),</span>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=w>  </span><span class=n>by</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>.</span><span class=p>(</span><span class=n>admin_area_1</span><span class=p>,</span><span class=w> </span><span class=n>indicator_common_id</span><span class=p>,</span><span class=w> </span><span class=n>period_id</span><span class=p>)</span>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=p>]</span>
</span></code></pre></div> </details> <details> <summary><strong>Troubleshooting</strong></summary> ### Common Issues **Issue 1: All values remain unadjusted** - **Possible causes**: - Indicator is in the excluded list (deaths) - Indicator flagged as low-volume - No outlier or completeness flags in input data - **Solution**: Check `M2_low_volume_exclusions.csv` and verify Module 1 outputs contain flags **Issue 2: Adjusted values seem unreasonable** - **Possible causes**: - Insufficient valid historical data for rolling averages - Genuine program changes being smoothed out - Seasonal patterns not captured by 6-month window - **Solution**: - Review facility-specific time series plots - Consider using "outliers only" scenario if completeness is good - Validate against program implementation records **Issue 3: Many NA values after adjustment** - **Possible causes**: - Facility has very sparse data - No valid values available for any adjustment method - Early months in time series lack historical data - **Solution**: - Expected for facilities with limited reporting history - Consider facility-level data quality filtering - National/subnational aggregates will sum available values **Issue 4: Subnational/national totals don't match expectations** - **Possible causes**: - NA values treated as zero in aggregation - Different scenarios produce different totals - Low reporting completeness overall - **Solution**: - Compare `count_final_none` vs `count_final_both` to assess adjustment impact - Review Module 1 completeness statistics - Consider data quality threshold for inclusion ### Quality Assurance Checks The module includes several quality checks: 1. **Low Volume Exclusions**: Automatically identifies and excludes indicators with zero high-value observations 2. **Adjustment Tracking**: Counts and reports number of values adjusted by each method 3. **Excluded Indicators**: Ensures deaths are never adjusted 4. **Console Logging**: Provides detailed progress and summary statistics **Example Console Output**: <div class="language-text highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>Running adjustments...
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a> -&gt; Adjusting outliers...
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>     Roll6 adjusted: 1,245
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>     Forward-filled: 89
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>     Backward-filled: 67
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>     Same-month LY: 34
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a>     Fallback mean: 12
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a> -&gt; Adjusting for completeness...
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a>     Roll6 filled: 2,103
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a>     Forward-filled: 234
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a>     Backward-filled: 178
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a>     Fallback mean: 45
</span></code></pre></div> </details> <details> <summary><strong>Usage Notes & Recommendations</strong></summary> ### Choosing the Right Scenario | Situation | Recommended Scenario | Rationale | |-----------|---------------------|-----------| | High data quality, minimal issues | `none` | No adjustment needed | | Sporadic outliers, good completeness | `outliers` | Address quality without imputation | | Good quality, poor reporting frequency | `completeness` | Fill gaps while preserving actual values | | Poor quality and completeness | `both` | Comprehensive cleaning | | Uncertainty about data quality | Compare all scenarios | Sensitivity analysis | ### Validation Steps After running this module, consider: 1. **Compare scenarios**: Examine differences between `count_final_none` and `count_final_both` 2. **Review exclusions**: Check `M2_low_volume_exclusions.csv` for unexpected indicators 3. **Aggregate analysis**: Ensure subnational and national totals are reasonable 4. **Temporal plots**: Visualize trends before/after adjustment to identify over-smoothing 5. **Facility-level spot checks**: Review adjustments for a sample of facilities ### Limitations 1. **Rolling windows assume stability**: Adjustments work best when service delivery is relatively stable. Genuine program changes (e.g., new campaigns) may be incorrectly smoothed. 2. **No adjustment uncertainty**: The module provides point estimates without confidence intervals. Adjusted values should be treated as estimates. 3. **Facility-specific adjustments**: No cross-facility borrowing of information. Facilities with very sparse data may have unstable adjustments. 4. **Seasonal patterns**: While same-month-last-year helps, strong within-year seasonality may not be fully captured by 6-month windows. 5. **NA treatment in aggregation**: Missing values are treated as zero when summing to higher geographic levels, which may underestimate totals if missingness is high. ### Best Practices 1. **Always produce all four scenarios**: Even if you plan to use only one, having all scenarios allows for sensitivity analysis and validation 2. **Document your scenario choice**: When using adjusted data for analysis, clearly document which scenario was used and why 3. **Cross-validate with program data**: Compare adjusted trends with known programmatic events (campaigns, stockouts, facility closures) 4. **Consider data recency**: Be cautious with adjustments for the most recent months, which have less surrounding data for rolling averages 5. **Monitor excluded indicators**: Review the exclusion files to ensure appropriate indicators are being adjusted </details> <hr> <p>Last edit 2025 November 8</p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../01_module_data_quality_assessment_documentation/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Module 1 · Data Quality Assessment"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Module 1 · Data Quality Assessment </div> </div> </a> <a href=../03_module_service_utilization_documentation/ class="md-footer__link md-footer__link--next" aria-label="Next: Module 3 · Service Utilization"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Module 3 · Service Utilization </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 FASTR Methodology Documentation </div> </div> <div class=md-social> <a href=/ target=_blank rel=noopener title=Home class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M277.8 8.6c-12.3-11.4-31.3-11.4-43.5 0l-224 208c-9.6 9-12.8 22.9-8 35.1S18.8 272 32 272h16v176c0 35.3 28.7 64 64 64h288c35.3 0 64-28.7 64-64V272h16c13.2 0 25-8.1 29.8-20.3s1.6-26.2-8-35.1zM240 320h32c26.5 0 48 21.5 48 48v96H192v-96c0-26.5 21.5-48 48-48"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "navigation.footer", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "content.tabs.link", "content.tooltips"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../assets/javascripts/bundle.f55a23d4.min.js></script> </body> </html>